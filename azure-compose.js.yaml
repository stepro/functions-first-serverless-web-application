services:
  frontend:
    staticWebsite:
      requires:
        +functionApp:
        images:
          methods: [PUT]
      content: www/dist
      settings:
        authEnabled: true
      index: index.html
  +functionApp:
    authentication:
      activeDirectory:
        appDisplayName: First Serverless Web Application
      tokenStore: true
      redirectTo: frontend
    source: javascript/site
  GetImages:
    function:
      requires: imageMetadata!
      source: javascript/GetImages
  GetUploadUrl:
    function:
      requires: images!
      source: javascript/GetUploadUrl
  ResizeImage:
    function:
      requires: [images!, thumbnails!, analyzer!, imageMetadata!]
      source: javascript/ResizeImage
  images:
    storageContainer:
      publicAccess: blob
  thumbnails:
    storageContainer:
      publicAccess: blob
  analyzer:
    cognitiveService:
      kind: ComputerVision
      pricingTier: F0
  imageMetadata:
    cosmosdbCollection:
      name: images
      database:
      - name: imagesdb
      throughput: 400
